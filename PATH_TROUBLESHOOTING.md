# è·¯å¾„é—®é¢˜æ•…éšœæŽ’é™¤æŒ‡å—

## ðŸš¨ é—®é¢˜æè¿°

åœ¨è¿è¡Œéƒ¨ç½²è„šæœ¬æ—¶é‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼š
```
[ERROR] æºç›®å½• / ä¸­æ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶
```

è¿™ä¸ªé”™è¯¯è¡¨æ˜Žè„šæœ¬æ— æ³•æ­£ç¡®è¯†åˆ«é¡¹ç›®æ ¹ç›®å½•ï¼Œå¯¼è‡´æ–‡ä»¶å¤åˆ¶å¤±è´¥ã€‚

## ðŸ” é—®é¢˜åŽŸå› 

### 1. è„šæœ¬è·¯å¾„è§£æžå¤±è´¥
- `$(dirname "$0")` åœ¨æŸäº›çŽ¯å¢ƒä¸‹å¯èƒ½è¿”å›žä¸æ­£ç¡®çš„è·¯å¾„
- ä½¿ç”¨è½¯é“¾æŽ¥æˆ–ç‰¹æ®Šæ–¹å¼æ‰§è¡Œè„šæœ¬æ—¶è·¯å¾„è§£æžå¼‚å¸¸
- åœ¨æŸäº›shellçŽ¯å¢ƒä¸‹ `$0` å˜é‡å¯èƒ½ä¸å‡†ç¡®

### 2. æ‰§è¡ŒçŽ¯å¢ƒé—®é¢˜
- è„šæœ¬ä¸åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æ‰§è¡Œ
- é€šè¿‡ç®¡é“æˆ–é‡å®šå‘æ–¹å¼æ‰§è¡Œè„šæœ¬
- åœ¨Dockerå®¹å™¨æˆ–ç‰¹æ®ŠçŽ¯å¢ƒä¸­è¿è¡Œ

### 3. æ–‡ä»¶ç³»ç»Ÿæƒé™é—®é¢˜
- å½“å‰ç”¨æˆ·æ²¡æœ‰è®¿é—®è„šæœ¬æ‰€åœ¨ç›®å½•çš„æƒé™
- è„šæœ¬æ–‡ä»¶è¢«ç§»åŠ¨æˆ–åˆ é™¤

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. è„šæœ¬æ”¹è¿›ï¼ˆå·²å®žæ–½ï¼‰

**ä½¿ç”¨æ›´å¯é çš„è·¯å¾„èŽ·å–æ–¹æ³•ï¼š**
```bash
# ä½¿ç”¨ BASH_SOURCE è€Œä¸æ˜¯ $0
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
```

**æ·»åŠ è·¯å¾„éªŒè¯ï¼š**
```bash
# æ£€æŸ¥è·¯å¾„æ˜¯å¦ä¸ºæ ¹ç›®å½•ï¼ˆå¼‚å¸¸æƒ…å†µï¼‰
if [[ "$SCRIPT_DIR" == "/" ]]; then
    log_error "æ£€æµ‹åˆ°å¼‚å¸¸çš„æºç›®å½•è·¯å¾„: $SCRIPT_DIR"
    exit 1
fi
```

**å¢žå¼ºè°ƒè¯•ä¿¡æ¯ï¼š**
```bash
# æ˜¾ç¤ºè¯¦ç»†çš„è·¯å¾„ä¿¡æ¯
log_info "è„šæœ¬è·¯å¾„: ${BASH_SOURCE[0]}"
log_info "é¡¹ç›®ç›®å½•: $SCRIPT_DIR"
log_info "å½“å‰ç”¨æˆ·: $(whoami)"
log_info "å·¥ä½œç›®å½•: $(pwd)"
```

### 2. æ­£ç¡®çš„æ‰§è¡Œæ–¹å¼

**æŽ¨èæ–¹å¼ï¼š**
```bash
# è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd /path/to/td_stock

# ç›´æŽ¥æ‰§è¡Œè„šæœ¬
./deploy.sh

# æˆ–è€…ä½¿ç”¨bashæ‰§è¡Œ
bash deploy.sh
```

**é¿å…çš„æ–¹å¼ï¼š**
```bash
# ä¸è¦ä½¿ç”¨ç»å¯¹è·¯å¾„åœ¨å…¶ä»–ç›®å½•æ‰§è¡Œ
cd /tmp
/path/to/td_stock/deploy.sh  # å¯èƒ½å¯¼è‡´è·¯å¾„é—®é¢˜

# ä¸è¦é€šè¿‡ç®¡é“æ‰§è¡Œ
cat deploy.sh | bash  # ä¼šä¸¢å¤±è„šæœ¬è·¯å¾„ä¿¡æ¯
```

### 3. çŽ¯å¢ƒæ£€æŸ¥

**éªŒè¯é¡¹ç›®ç»“æž„ï¼š**
```bash
# ç¡®ä¿åœ¨æ­£ç¡®çš„ç›®å½•
ls -la
# åº”è¯¥çœ‹åˆ°ï¼šdeploy.sh, requirements.txt, config.py ç­‰æ–‡ä»¶

# æ£€æŸ¥è„šæœ¬æƒé™
ls -l deploy.sh
# åº”è¯¥æœ‰æ‰§è¡Œæƒé™ (-rwxr-xr-x)
```

**è®¾ç½®æ‰§è¡Œæƒé™ï¼š**
```bash
chmod +x deploy.sh
```

## ðŸ”§ æ•…éšœæŽ’é™¤æ­¥éª¤

### æ­¥éª¤1ï¼šéªŒè¯å½“å‰ä½ç½®
```bash
pwd
ls -la
```
ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œèƒ½çœ‹åˆ° `deploy.sh` æ–‡ä»¶ã€‚

### æ­¥éª¤2ï¼šæ£€æŸ¥è„šæœ¬æƒé™
```bash
ls -l deploy.sh
```
ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™ã€‚

### æ­¥éª¤3ï¼šæ‰‹åŠ¨æµ‹è¯•è·¯å¾„èŽ·å–
```bash
# æµ‹è¯•è·¯å¾„èŽ·å–å‘½ä»¤
echo "$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
```

### æ­¥éª¤4ï¼šä½¿ç”¨è°ƒè¯•æ¨¡å¼
```bash
# å¯ç”¨bashè°ƒè¯•æ¨¡å¼
bash -x deploy.sh
```
è¿™ä¼šæ˜¾ç¤ºæ¯ä¸ªå‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹ã€‚

### æ­¥éª¤5ï¼šæ£€æŸ¥ç³»ç»ŸçŽ¯å¢ƒ
```bash
# æ£€æŸ¥shellç±»åž‹
echo $SHELL

# æ£€æŸ¥bashç‰ˆæœ¬
bash --version

# æ£€æŸ¥å½“å‰ç”¨æˆ·
whoami
id
```

## ðŸ›¡ï¸ é¢„é˜²æŽªæ–½

### 1. æ ‡å‡†åŒ–æ‰§è¡Œæµç¨‹
```bash
# åˆ›å»ºæ ‡å‡†æ‰§è¡Œè„šæœ¬
cat > run_deploy.sh << 'EOF'
#!/bin/bash
cd "$(dirname "$0")"
./deploy.sh
EOF
chmod +x run_deploy.sh
```

### 2. æ·»åŠ çŽ¯å¢ƒæ£€æŸ¥
åœ¨è„šæœ¬å¼€å¤´æ·»åŠ æ›´å¤šæ£€æŸ¥ï¼š
```bash
# æ£€æŸ¥å¿…è¦æ–‡ä»¶
if [[ ! -f "requirements.txt" ]]; then
    echo "é”™è¯¯ï¼šæœªåœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œè„šæœ¬"
    echo "å½“å‰ç›®å½•ï¼š$(pwd)"
    exit 1
fi
```

### 3. ä½¿ç”¨ç»å¯¹è·¯å¾„
å¦‚æžœéœ€è¦ä»Žå…¶ä»–ä½ç½®æ‰§è¡Œï¼š
```bash
# è®¾ç½®é¡¹ç›®æ ¹ç›®å½•
PROJECT_ROOT="/home/user/td_stock"
cd "$PROJECT_ROOT"
./deploy.sh
```

## ðŸ“‹ å¸¸è§é—®é¢˜è§£ç­”

### Q: ä¸ºä»€ä¹ˆä¼šå‡ºçŽ°æºç›®å½•æ˜¯ `/` çš„æƒ…å†µï¼Ÿ
A: è¿™é€šå¸¸å‘ç”Ÿåœ¨ä»¥ä¸‹æƒ…å†µï¼š
- è„šæœ¬é€šè¿‡è½¯é“¾æŽ¥æ‰§è¡Œ
- åœ¨å®¹å™¨çŽ¯å¢ƒä¸­æ‰§è¡Œ
- `dirname` å‘½ä»¤æ— æ³•æ­£ç¡®è§£æžè·¯å¾„
- è„šæœ¬è¢«ç§»åŠ¨æˆ–é‡å‘½å

### Q: å¦‚ä½•ç¡®ä¿è„šæœ¬åœ¨æ­£ç¡®çš„ç›®å½•æ‰§è¡Œï¼Ÿ
A: æœ€ä½³å®žè·µï¼š
1. å§‹ç»ˆåœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œè„šæœ¬
2. ä½¿ç”¨ `./deploy.sh` è€Œä¸æ˜¯ç»å¯¹è·¯å¾„
3. æ£€æŸ¥è„šæœ¬è¾“å‡ºçš„è·¯å¾„ä¿¡æ¯

### Q: è„šæœ¬ä¿®æ”¹åŽè¿˜æ˜¯æœ‰é—®é¢˜æ€Žä¹ˆåŠžï¼Ÿ
A: å°è¯•ä»¥ä¸‹æ­¥éª¤ï¼š
1. é‡æ–°ä¸‹è½½æˆ–å…‹éš†é¡¹ç›®
2. æ£€æŸ¥æ–‡ä»¶æƒé™å’Œæ‰€æœ‰æƒ
3. åœ¨ä¸åŒçš„shellçŽ¯å¢ƒä¸­æµ‹è¯•
4. è”ç³»æŠ€æœ¯æ”¯æŒå¹¶æä¾›è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

## ðŸ” è°ƒè¯•æŠ€å·§

### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—
```bash
# åœ¨è„šæœ¬å¼€å¤´æ·»åŠ 
set -x  # æ˜¾ç¤ºæ‰§è¡Œçš„å‘½ä»¤
set -v  # æ˜¾ç¤ºè¯»å–çš„è¡Œ
```

### 2. æ‰‹åŠ¨éªŒè¯è·¯å¾„
```bash
# æµ‹è¯•å„ç§è·¯å¾„èŽ·å–æ–¹æ³•
echo "æ–¹æ³•1: $(dirname "$0")"
echo "æ–¹æ³•2: $(dirname "${BASH_SOURCE[0]}")"
echo "æ–¹æ³•3: $(readlink -f "$0")"
echo "æ–¹æ³•4: $(realpath "$0")"
```

### 3. æ£€æŸ¥çŽ¯å¢ƒå˜é‡
```bash
# æ˜¾ç¤ºç›¸å…³çŽ¯å¢ƒå˜é‡
echo "PWD: $PWD"
echo "HOME: $HOME"
echo "USER: $USER"
echo "SHELL: $SHELL"
```

## ðŸ“ž èŽ·å–å¸®åŠ©

å¦‚æžœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. å®Œæ•´çš„é”™è¯¯æ—¥å¿—
2. ç³»ç»Ÿä¿¡æ¯ (`uname -a`)
3. æ‰§è¡ŒçŽ¯å¢ƒæè¿°
4. é¡¹ç›®ç›®å½•ç»“æž„ (`ls -la`)
5. è„šæœ¬æ‰§è¡Œæ–¹å¼

é€šè¿‡è¿™äº›æ”¹è¿›ï¼Œè·¯å¾„è§£æžé—®é¢˜åº”è¯¥å¾—åˆ°å½»åº•è§£å†³ã€‚